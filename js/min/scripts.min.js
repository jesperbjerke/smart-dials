jQuery.extend({getQueryParams:function(e){return(e||document.location.search).replace(/(^\?)/,"").split("&").map(function(e){return e=e.split("="),this[e[0]]=e[1],this}.bind({}))[0]}}),$(document).ready(function(e){function t(e,t){var a=parseInt(e.slice(1),16),n=0>t?0:255,i=0>t?-1*t:t,o=a>>16,s=a>>8&255,r=255&a;return"#"+(16777216+65536*(Math.round((n-o)*i)+o)+256*(Math.round((n-s)*i)+s)+(Math.round((n-r)*i)+r)).toString(16).slice(1)}function a(e){e=e||(new Date).getTime();var t=new Date(e).getHours(),a="";return t>=6&&9>=t&&(a="morning"),t>=10&&12>=t&&(a="day"),t>=13&&17>=t&&(a="afternoon"),t>=18&&21>=t&&(a="evening"),(t>=22||5>=t)&&(a="night"),a}function n(){function t(){1==m.features.beSmart?(e("#dials #topDials").isotope({filter:function(){var t=e(this).attr("data-"+h+"-"+n);return t>0?!0:!1},sortBy:[h+n]}),e("#dials #filteredDials").isotope({filter:function(){var t=e(this).attr("data-"+h+"-"+n);return 0==t?!0:!1},sortBy:[h+n]})):(e("#editDial button").addClass("double"),e("#editDial button.rearrange").removeClass("disabled"),e("#editDial button.rearrange").click(function(){chrome.tabs.update({url:"chrome://newtab?arrange=true",active:!0})}),e("#dials #topDials").isotope({sortBy:[h]}),$arrangeQuery=e.getQueryParams(),"undefined"!==e.type($arrangeQuery.arrange)&&"true"==$arrangeQuery.arrange&&chrome.storage.sync.get(null,function(t){var a=e("#dials #topDials").data("isotope"),n=1;e.each(a.filteredItems,function(a,i){var o=e(i.element).attr("data-id");"undefined"===e.type(t[o].order)?(t[o].order={},t[o].order[h]=n):t[o].order[h]=n,n++}),e("#dials #topDials").find(".column").hover(function(){function a(a,i){e.each(t,function(n,o){return"undefined"!==e.type(o.id)&&o.order[h]==a?(t[o.id].order[h]=i,e('.column[data-id="'+o.id+'"]').attr("data-"+h+"-order",i),!1):void 0}),t[n.attr("data-id")].order[h]=a,n.attr("data-"+h+"-order",a),e("#dials #topDials .column[data-"+h+'-order="'+i+'"]').attr("data-"+h+"-order",i),e("#dials #topDials").isotope("updateSortData").isotope()}var n=e(this),i=t[n.attr("data-id")].order[h];0!==i&&1!==i?n.prepend('<span class="move-left arrow_left" title="Move left"></span><span class="move-right arrow_right" title="Move right"></span>'):n.prepend('<span class="move-right arrow_right" title="Move right"></span>');var o=1;n.find(".move-left").click(function(){o=i-1!==0?i-1:1,a(o,i)}),n.find(".move-right").click(function(){o=i+1,a(o,i)})},function(){e(this).find(".move-left, .move-right").remove()}),e("#dials #topDials").prepend('<span id="saveOrder"><span class="icon_floppy"></span> Save current order</span>'),e("#saveOrder").click(function(){chrome.storage.sync.set(t,function(){chrome.tabs.update({url:"chrome://newtab",active:!0})})})})),m.features.suggestions===!0&&e("#dials #suggestedDials").isotope({filter:function(){var t=e(this).attr("data-"+n);return t>0?!0:!1},sortBy:[n]})}var n=a();t(),chrome.omnibox.onInputStarted.addListener(function(){e("#dials").hasClass("show")||(e(".content").removeClass("show"),e("#dials").addClass("show"));{var a,n=e("#dials #topDials"),i=e("#dials #suggestedDials");e("#dialSearch input#search")}chrome.omnibox.onInputChanged.addListener(function(o){a=new RegExp(o,"gi"),""!==o?(n.isotope({filter:function(){return a?e(this).text().match(a):!0}}),i.isotope({filter:function(){return a?e(this).text().match(a):!0}})):t()})}),e('#sortingOptions #optionsInner li[data-value="'+h+'"]').addClass("current"),e('#sortingOptions #optionsInner li[data-value="'+n+'"]').addClass("current"),e("#sortingOptions #currently").html('<span class="'+h+'">'+h+'</span> <span class="'+n+'">'+n+"</span>"),e("#sortingOptions").on("click",function(){e("#sortingOptions").addClass("show")}),e("#dials .row").on("click",function(){e("#sortingOptions").removeClass("show")}),e("#sortingOptions #optionsInner li").on("click",function(){var a=e(this).attr("data-value");"home"==a||"work"==a?(h=a,chrome.storage.local.set({environment:h})):n=a,t(),e("#sortingOptions #currently").html('<span class="'+h+'">'+h+'</span><span class="'+n+'">'+n+"</span>"),e("#sortingOptions #optionsInner li").removeClass("current"),e('#sortingOptions #optionsInner li[data-value="'+h+'"]').addClass("current"),e('#sortingOptions #optionsInner li[data-value="'+n+'"]').addClass("current")})}function i(t){t.parent().find(".dialLoader").show().addClass("show undo").html('<span class="arrow_back"></span>');var a=setTimeout(function(){t.parent().find(".dialLoader").removeClass("undo").addClass("delete").html('<span class="icon_trash_alt"></span>'),e("#dials #topDials").isotope("remove",t.parent()),e("#dials #topDials").isotope("layout"),e("#dials #filteredDials").isotope("remove",t.parent()),e("#dials #filteredDials").isotope("layout");var a=t.attr("data-id");chrome.storage.sync.remove(a)},3e3);t.parent().find(".dialLoader").on("click",function(){clearTimeout(a),e(this).removeClass("show").delay(500).hide()})}function o(t){e(".deleteDial").on("click",function(){i(e(this))}),e(".editDial").on("click",function(){var t=e(this).attr("data-id");chrome.storage.sync.get(t,function(a){var n=e("#editDial").find("input#name"),i=e("#editDial").find("input#url");if(n.val(a[t].name),i.val(a[t].url),""===a[t].thumb||"undefined"===e.type(a[t].thumb)){e("#editDial .inputContainer.center").show(),"undefined"===e.type(a.color)&&e("#picker").css("border-color","#"+a.color);var o="";e("#picker").colpick({layout:"hex",submit:0,colorScheme:"dark",onChange:function(t,a,s,r,d){e(r).css("border-color","#"+a),d||e(r).val(a),o=this.value,""!==n.val()&&""!==i.val()&&""!==o?e("#editDial").find(".submit").removeClass("disabled"):e("#editDial").find(".submit").addClass("disabled")}}).keyup(function(){e(this).colpickSetColor(this.value),""!==n.val()&&""!==i.val()&&""!==o?e("#editDial").find(".submit").removeClass("disabled"):e("#editDial").find(".submit").addClass("disabled")})}else e("#editDial .inputContainer.center").hide();e("#editDial").find("input").on("keyup",function(){n.val()!==a[t].name||i.val()!==a[t].url?""!==n.val()&&""!==i.val()?e("#editDial").find(".submit").removeClass("disabled"):e("#editDial").find(".submit").addClass("disabled"):e("#editDial").find(".submit").addClass("disabled")}),e("#editDial").addClass("show"),e("#editDial .closeDialog").click(function(){e("#editDial").removeClass("show"),e("#editDial").find("input#name").val(""),e("#editDial").find("input#url").val("")}),e("#editDial .submit").click(function(){if(!e(this).hasClass("disabled")){var o=n.val(),r=i.val();a[t].name=o,a[t].url=r;var d=e("#picker").val();""!==d&&"undefined"!==d&&(a[t].color=d),chrome.storage.sync.set(a,function(){s()})}})})}),e(".dial").on("click",function(n){if(!e(this).hasClass("suggestion")){var i=e(this).attr("data-thumbnail"),o=e(this).attr("data-id"),s=e(this).attr("href"),r=a();1==i&&n.preventDefault();var d={};d[o]=t[o],d[o].smartGroups[h][r]=d[o].smartGroups[h][r]+1,1==i?(d[o].setThumb=0,chrome.tabs.create({url:s},function(e){var t=1;chrome.tabs.onUpdated.addListener(function(a,n,i){e.id==a&&"complete"==i.status&&1==t&&(t=0,d[o].favicon=i.favIconUrl,chrome.storage.sync.set(d,function(){chrome.tabs.executeScript(a,{code:'localStorage.setItem("dialID",'+o+");"},function(){chrome.tabs.executeScript(a,{file:"js/min/thumbnail.min.js"})})}))})})):chrome.storage.sync.set(d)}})}function s(){if(e("#dials #topDials").isotope("destroy"),e("#dials #filteredDials").isotope("destroy"),e("#dials #suggestedDials").isotope("destroy"),"undefined"===e.type(m.columns)&&(m.columns=5),5!==m.columns){var i=e("#dials #topDials, #dials #filteredDials, #dials #suggestedDials");i.removeClass().addClass("row count-"+m.columns)}chrome.storage.sync.get(null,function(i){function s(t){var a=[],i=0;e.each(t,function(e,t){i++;var n=['data-morning="'+t.visits.morning+'"','data-day="'+t.visits.day+'"','data-afternoon="'+t.visits.afternoon+'"','data-evening="'+t.visits.evening+'"','data-night="'+t.visits.night+'"'];a.push('<div class="column" '+n.join(" ")+'><a class="dial suggestion usePlaceholder ver-'+i+'" href="'+t.url+'"><div class="dialName"><div class="nameInner">'+t.name+'</div></div></a><div class="dialLoader"></div></div>')}),e("#dials #suggestedDials").html(a.join("")),e("#dials #suggestedDials").isotope({itemSelector:"#dials #suggestedDials .column",getSortData:{morning:"[data-morning]",day:"[data-day]",afternoon:"[data-afternoon]",evening:"[data-evening]",night:"[data-night]"},sortAscending:!1}),n()}var r=[];if(e.each(i,function(a,n){if("settings"!==a){var i="";if("undefined"!==e.type(n.color)||n.thumb&&void 0!=n.thumb&&""!=n.thumb||(i+=" usePlaceholder ver-"+n.id),1==m.features.beSmart)var o=['data-home-morning="'+n.smartGroups.home.morning+'"','data-home-day="'+n.smartGroups.home.day+'"','data-home-afternoon="'+n.smartGroups.home.afternoon+'"','data-home-evening="'+n.smartGroups.home.evening+'"','data-home-night="'+n.smartGroups.home.night+'"','data-work-morning="'+n.smartGroups.work.morning+'"','data-work-day="'+n.smartGroups.work.day+'"','data-work-afternoon="'+n.smartGroups.work.afternoon+'"','data-work-evening="'+n.smartGroups.work.evening+'"','data-work-night="'+n.smartGroups.work.night+'"'];else{var s=1,d=1;"undefined"!==e.type(n.order)&&("undefined"!==e.type(n.order.home)&&(s=n.order.home,0===s&&(s=1)),"undefined"!==e.type(n.order.work)&&(d=n.order.work,0===d&&(d=1)));var o=['data-home-order="'+s+'"','data-work-order="'+d+'"']}var l="";if("undefined"!==e.type(n.color)){var c="#"+n.color,u=t(c,.35);l="background: linear-gradient(45deg, "+c+" 0%, "+u+" 100%) !important;"}r.push('<div class="column" data-id="'+n.id+'" '+o.join(" ")+'><div class="deleteDial" title="Delete" data-id="'+n.id+'"><span class="icon_trash_alt"></span></div><div class="editDial" title="Edit" data-id="'+n.id+'"><span class="icon_pencil"></span></div><a class="dial'+i+'" href="'+n.url+'" data-id="'+n.id+'" data-thumbnail="'+n.setThumb+'" style="background-image:url('+n.thumb+"); "+l+'"><div class="dialName"><div class="nameInner"><span class="faviconImg" style="background-image:url('+n.favicon+')"></span>'+n.name+'</div></div></a><div class="dialLoader"></div></div>')}}),e("#dials #topDials").html(r.join("")),m.features.beSmart===!0?(e("#dials #filteredDials").html(r.join("")),e("#dials #topDials").isotope({itemSelector:"#dials #topDials .column",getSortData:{homemorning:"[data-home-morning] parseInt",homeday:"[data-home-day] parseInt",homeafternoon:"[data-home-afternoon] parseInt",homeevening:"[data-home-evening] parseInt",homenight:"[data-home-night] parseInt",workmorning:"[data-work-morning] parseInt",workday:"[data-work-day] parseInt",workafternoon:"[data-work-afternoon] parseInt",workevening:"[data-work-evening] parseInt",worknight:"[data-work-night] parseInt"},sortAscending:!1}),e("#dials #filteredDials").isotope({itemSelector:"#dials #filteredDials .column",getSortData:{homemorning:"[data-home-morning] parseInt",homeday:"[data-home-day] parseInt",homeafternoon:"[data-home-afternoon] parseInt",homeevening:"[data-home-evening] parseInt",homenight:"[data-home-night] parseInt",workmorning:"[data-work-morning] parseInt",workday:"[data-work-day] parseInt",workafternoon:"[data-work-afternoon] parseInt",workevening:"[data-work-evening] parseInt",worknight:"[data-work-night] parseInt"},sortAscending:!1})):e("#dials #topDials").isotope({itemSelector:"#dials #topDials .column",getSortData:{home:"[data-home-order] parseInt",work:"[data-work-order] parseInt"},sortAscending:{home:!0,work:!0}}),m.features.suggestions===!0){var d=new Date,l=new Date(d.getFullYear(),d.getMonth(),d.getDate()-7).getTime();chrome.history.search({text:"",startTime:l,maxResults:500},function(t){function n(e){if(e==t.length)s(u);else{var i=t[e];if(i.visitCount>3&&""!=i.title){var r=i.url;if(-1==r.indexOf("feedly")&&-1==r.indexOf("evernote")){var d=r.substr(r.indexOf("://")+3);d=d.replace(/www\./g,""),-1!==d.indexOf("/")&&(d=d.substr(0,d.indexOf("/"))),-1==o.indexOf(d)?(u[i.id]={url:r,name:i.title},chrome.history.getVisits({url:r},function(i){for(var o={morning:0,day:0,afternoon:0,evening:0,night:0},s=i.length,r=0;s>r;r++){var d=i[r],l=a(d.visitTime);o[l]++,r==s-1&&(u[i[0].id].visits=o,e++,e<=t.length&&n(e))}})):(e++,e<=t.length&&n(e))}else e++,e<=t.length&&n(e)}else e++,e<=t.length&&n(e)}}for(var o=[],r=Object.keys(i).length,d=1;r>d;d++)if("undefined"!==e.type(i[d])){var l=i[d].url,c=l.substr(l.indexOf("://")+3);c=c.replace(/www\./g,""),-1!==c.indexOf("/")&&(c=c.substr(0,c.indexOf("/"))),o.push(c)}var u={},m=0;n(m)}),e("#loader").hide(),e("#dials").addClass("show"),o(i)}else e("#dials #suggestedDials").hide(),e("#loader").hide(),e("#dials").addClass("show"),o(i),n()})}function r(t){var a;try{a=e.parseJSON(t)}catch(n){alert('cannot load data because: "'+n+'", please try and copy and paste the whole output from SpeedDial 2 anew and try again')}if("undefinied"!==e.type(a))if("undefined"!==e.type(a.dials["0"])){var i=confirm("This will overwrite all your current dials, continue?");if(1==i){var o={},r=1;e.each(a.dials,function(e,t){o[r]={id:r,name:t.title,url:t.url,thumbnail:"",thumb:"",setThumb:1,order:{home:1,work:1},smartGroups:{home:{morning:0,day:0,afternoon:0,evening:0,night:0},work:{morning:0,day:0,afternoon:0,evening:0,night:0}}},r++}),chrome.storage.sync.set(o,function(){alert("Import successful!"),e("#import textarea").val(""),e("#import").removeClass("show"),e("#settingsInput").addClass("show"),s()})}}else alert("No dials found in the export object, are you sure you have any saved?")}function d(){e("#pocketDials").isotope("destroy"),e("#pocketDials").isotope({itemSelector:".column",layoutMode:"packery",packery:{rowHeight:220}})}function l(t,a,n){n=n||!1,e.getJSON(p+v,{consumer_key:y,access_token:t,sort:"newest",detailType:"complete"}).done(function(i){function o(e,t){var a=1e3*e.time_added,n=1e3*t.time_added;return new Date(n)-new Date(a)}function s(e,t){var a;return function(){function n(){e(),a=null}a&&clearTimeout(a),a=setTimeout(n,t||100)}}var r=0,l=[],c=[];if(e.each(i.list,function(e,t){c.push(t)}),c.sort(o),e('#menu li[data-target="pocket"]').find(".count").addClass("show").text(c.length),1==a){if(e.each(c,function(t,a){var n="column",i="pocket-item row",o="",s=new Date(1e3*a.time_added),d=e.format.date(s,"E dd MMM, yyyy"),c="",u="buttongrp",m='<span class="pocketModify setAsFav icon_star_alt" data-action="favorite"></span>';1==a.favorite&&(n+=" favorite",m='<span class="pocketModify setAsFav icon_star" data-action="unfavorite"></span>',0==a.is_article&&(n+=" sv-no-big")),1==a.has_image||2==a.has_image?("undefined"!==e.type(a.image)&&(o='<div class="image-container" style="background-image:url('+a.image.src+');"></div>'),-1!=o.search(/(icon-x-30-white)/i)?(i+=" error-image",o="",0==a.is_article&&1!=a.favorite&&(n+=" no-big sv-no-big")):(i+=" has-image",u+=" has-image")):(i+=" no-image",0==a.is_article&&1!=a.favorite&&(n+=" no-big sv-no-big")),1==a.is_article&&(c='<span class="pocket-excerpt">'+a.excerpt+"</span>");var h='<div class="'+u+'">'+m+' <span class="pocketModify setAsRead icon_check_alt2" data-action="archive"></span> <span class="pocketModify setAsRemove icon_trash_alt" data-action="delete"></span></div>',p=[];"undefined"!==e.type(a.tags)&&e.each(a.tags,function(e,t){p.push(t.tag)}),l.push('<div data-id="'+a.item_id+'" class="'+n+'"><a class="'+i+'" href="'+a.resolved_url+'"><div class="pocketLoader"></div>'+o+'<div class="item-text">'+a.resolved_title+"<br/>"+c+'<span class="pocket-meta">'+d+'</span><div class="pocketTags" style="display:none;">'+p.join(" ")+"</div></div></a>"+h+"</div>"),r++}),e("#pocketDials").html(l.join("")),e("#loader").hide(),e("#pocket").addClass("show"),e(".column").each(function(){return 220==e(this).height()?(console.log(e(this).innerWidth()),d(e(this).innerWidth()),!1):void 0}),1==n){e("#pocketSearch").addClass("show"),e("#pocketSearch input#search").focus();var u,m=e("#pocketDials").isotope({filter:function(){return u?e(this).text().match(u):!0}}),h=e("#pocketSearch input#search").keyup(s(function(){u=new RegExp(h.val(),"gi"),m.isotope()},200))}e(".pocketModify").click(function(){function a(){e.ajax(p+k+"?actions=%5B%7B%22action%22%3A%22"+o+"%22%2C%22item_id%22%3A"+s+"%7D%5D&access_token="+t+"&consumer_key="+y).done(function(){if("favorite"==o)i.hasClass("no-big")&&i.removeClass("no-big"),i.addClass("favorite"),n.removeClass("icon_star_alt"),n.addClass("icon_star"),n.attr("data-action","unfavorite"),setTimeout(function(){i.find(".pocketLoader").fadeOut("slow").removeClass("show favorite"),e("#pocketDials").isotope("layout")},500);else if("archive"==o||"delete"==o){e("#pocketDials").isotope("remove",i).isotope("on","removeComplete",function(){setTimeout(function(){e("#pocketDials").isotope("layout")},500)});var t=0;e("#pocket .column").each(function(e){t=e}),e('#menu li[data-target="pocket"]').find(".count").text(t)}else"unfavorite"==o&&(i.hasClass("sv-no-big")&&i.addClass("no-big"),i.removeClass("favorite"),n.removeClass("icon_star"),n.addClass("icon_star_alt"),n.attr("data-action","favorite"),setTimeout(function(){i.find(".pocketLoader").fadeOut("slow").removeClass("show unfavorite"),e("#pocketDials").isotope("layout")},500))}).fail(function(e,t,a){var n=t+", "+a;console.log("Request Failed: "+n)})}var n=e(this),i=e(this).parent().parent(),o=e(this).attr("data-action"),s=i.attr("data-id");"delete"==o?(e("#confirmation").hide("fast").remove(),n.addClass("active"),e(this).parent().prepend(e('<div id="confirmation" class="row">Are you sure?<br/><span id="confirm">Delete</span> <span id="regret">Cancel</span></div>').hide().show("fast")),e("#confirm").click(function(){e("#confirmation").hide("fast").remove(),n.removeClass("active"),i.find(".pocketLoader").show().addClass("show delete").html('<span class="delete"></span>'),a()}),e("#regret").click(function(){e("#confirmation").hide("fast").remove(),n.removeClass("active")}),i.mouseleave(function(){e("#confirmation").hide("fast").remove(),n.removeClass("active")})):(i.find(".pocketLoader").show().addClass("show "+o).html('<span class="'+o+'"></span>'),a())})}})}function c(){function t(e){if(!e.icons||0==e.icons.length)return chrome.extension.getURL("icon.png");for(var t={size:0},a=0;a<e.icons.length;a++){var n=e.icons[a];n.size>t.size&&(t=n)}return t.url}chrome.management.getAll(function(a){var n=[];e.each(a,function(e,a){if(1==a.isApp&&1==a.enabled){var i='<div class="column" data-id="'+a.id+'"><a href="javascript:void(0);"><img src="'+t(a)+'" /><span class="appName" title="'+a.description+'">'+a.name+"</span></a></div>";n.push(i)}}),0!==n.length&&(e("#apps .row").html(n.join("")),e("#loader").hide(),e("#apps").addClass("show"),e("#apps .row").isotope({itemSelector:"#apps .column"}),e("#apps .column").click(function(){var t=e(this).attr("data-id");chrome.management.launchApp(t)}))})}function u(){function t(n){for(var i=0;i<n.length;i++)"undefined"!==e.type(n[i].children)?t(n[i].children):a[n[i].id]={name:n[i].title,url:n[i].url}}var a={};chrome.bookmarks.getTree(function(n){if(t(n),e.isEmptyObject(a)===!1){var i=confirm("Found a total of "+Object.keys(a).length+" bookmarks. This will overwrite all your current dials, continue?");if(1==i){var o={},r=1;e.each(a,function(e,t){o[r]={id:r,name:t.name,url:t.url,thumbnail:"",thumb:"",setThumb:1,order:{home:1,work:1},smartGroups:{home:{morning:0,day:0,afternoon:0,evening:0,night:0},work:{morning:0,day:0,afternoon:0,evening:0,night:0}}},r++}),chrome.storage.sync.set(o,function(){alert("Import successful!"),s()})}}else alert("Sorry! Couldn'nt find any bookmarks")})}var m={};chrome.storage.sync.get("settings",function(t){"undefined"===e.type(t.settings)?chrome.storage.sync.set({settings:{features:{pocket:!0,evernote:!0,feedly:!0,apps:!0,suggestions:!0,beSmart:!0},columns:5}},function(){chrome.tabs.reload()}):("undefined"==e.type(t.settings.features.beSmart)&&(t.settings.features.beSmart=!0,chrome.storage.sync.set(t,function(){chrome.tabs.reload()})),m=t.settings,"undefined"!==e.type(t.settings.pocket)&&1==t.settings.features.pocket?l(t.settings.pocket.token,!1):(e("#pocket").addClass("not-logged-in"),e('#menu li[data-target="pocket"] .popOut-btn').addClass("disabled")),s()),e.each(t.settings.features,function(t,a){0==a&&(e('#menu li[data-target="'+t+'"]').hide(),e('#settings .onoffswitch .onoffswitch-checkbox[data-value="'+t+'"]').prop("checked",!1))})});var h="";chrome.storage.local.get("environment",function(t){"undefined"===e.type(t.environment)?(e("#setEnvironment").show().addClass("show"),e("#setEnvironment .option").click(function(){h=e(this).attr("data-value"),chrome.storage.local.set({environment:h},function(){e("#setEnvironment").removeClass("show").delay(500).hide(),setTimeout(function(){chrome.tabs.reload()},500)})})):h=t.environment}),e('#menu li[data-target="dials"]').addClass("active"),e("body").mCustomScrollbar({theme:"light",scrollInertia:300}),e("#menu li .menu-icon").click(function(){var t=e(this).parent().attr("data-target");"evernote"!==t&&"feedly"!==t&&"settings"!==t&&(e("#menu li").removeClass("active"),e(this).parent().addClass("active"),e("#loader img").attr("src","images/"+t+"-btn.png"),e(".content").removeClass("show"),e("#loader").show()),"dials"==t?s():"apps"==t?c():"pocket"==t?e("#pocket").hasClass("not-logged-in")?(e("#loader").hide(),e("#pocket").addClass("show")):chrome.storage.sync.get("settings",function(e){l(e.settings.pocket.token,!0)}):"evernote"==t?chrome.tabs.create({url:"https://www.evernote.com/Home.action"}):"feedly"==t?chrome.tabs.create({url:"http://feedly.com"}):"settings"==t&&(e("#settings .columnCount").find('.columns[data-value="'+m.columns+'"]').addClass("active"),e("#settings").addClass("show"),e("#settings .closeDialog").click(function(){e("#settings").removeClass("show"),e("#import").removeClass("show"),e("#settingsInput").addClass("show"),e("#import textarea").val("")}))}),e("#settings").find(".onoffswitch").click(function(){var t=e(this).find(".onoffswitch-checkbox"),a=t.attr("data-value");chrome.storage.sync.get("settings",function(n){t.prop("checked")?(n.settings.features[a]=!0,e('#menu li[data-target="'+a+'"]').show()):(n.settings.features[a]=!1,e('#menu li[data-target="'+a+'"]').hide()),chrome.storage.sync.set(n,function(){"beSmart"==a&&chrome.tabs.reload()}),m=n.settings})}),e("#settings .columnCount").find(".columns").click(function(){var t=e(this).attr("data-value");e("#settings .columnCount").find(".columns").removeClass("active"),e(this).addClass("active"),chrome.storage.sync.get("settings",function(e){e.settings.columns=t,m=e.settings,chrome.storage.sync.set(e,function(){s()})})}),e("#settings #speedDialImport").click(function(){e("#settingsInput").removeClass("show"),e("#import").addClass("show"),e("#import").find("textarea").keyup(function(){""!==e("#import textarea").val()?e("#import-btn").removeClass("disabled"):e("#import-btn").addClass("disabled")})}),e("#import-btn").click(function(){e(this).hasClass("disabled")||r(e("#import textarea").val())});var p="https://getpocket.com/v3/",f="oauth/request",g="oauth/authorize",v="get",k="send",y="29891-62d35387246a98487a6065ee",w=location.search.replace("?","").split("=");0!==w.length&&("authpocket"==w[1]?chrome.storage.sync.get("settings",function(t){"undefined"!==e.type(t.settings.pocketCode)&&e.ajax({type:"POST",url:p+g,headers:{contentType:"application/json; charset=UTF-8","X-Accept":"application/json"},data:{consumer_key:y,code:t.settings.pocketCode},success:function(e){chrome.storage.sync.get("settings",function(t){t.settings.pocket={username:e.username,token:e.access_token},chrome.storage.sync.set(t,function(){chrome.tabs.update({url:"chrome://newtab?state=goToPocket",active:!0})})})},error:function(e,t,a){console.log("jqXHR: "+e+"textStatus: "+t+"errorThrown: "+a);var n=confirm("Authorization to Pocket failed, try again?");1==n?chrome.tabs.reload():chrome.tabs.update({url:"chrome://newtab",active:!0})}})}):"goToPocket"==w[1]&&e(window).load(function(){e('#menu li[data-target="pocket"] .menu-icon').trigger("click")})),e("#authPocket").click(function(){e.ajax({type:"POST",url:p+f,headers:{contentType:"application/json; charset=UTF-8","X-Accept":"application/json"},data:{consumer_key:y,redirect_uri:"/"},success:function(e){chrome.storage.sync.get("settings",function(t){t.settings.pocketCode=e.code,chrome.storage.sync.set(t,function(){chrome.tabs.create({url:"https://getpocket.com/auth/authorize?request_token="+e.code+"&redirect_uri=/"},function(e){chrome.tabs.onUpdated.addListener(function(t,a){t==e.id&&"http://getpocket.com/a/"==a.url&&chrome.tabs.remove(e.id,function(){chrome.tabs.update({url:"chrome://newtab/?state=authpocket",active:!0})})})})})})}})}),e("#addDial-btn").click(function(){e("#addDial").addClass("show"),e("#addDial input#url").focus()}),e("#addDial .closeDialog").click(function(){e("#addDial").removeClass("show"),e("#topSitesList").removeClass("show"),e("#addInputs").addClass("show"),e("#addDial input#url").val(""),e("#addDial input#name").val(""),e("#addDial #innerDialogContent").css({height:e("#addInputs").height()+20})}),e("#addInputs").find("input").keyup(function(){""!==e("#addDial input#url").val()&&""!==e("#addDial input#name").val()?e("#addInputs").find(".submit").removeClass("disabled"):e("#addInputs").find(".submit").addClass("disabled")}),e("#manageApps-btn").click(function(){chrome.tabs.create({url:"chrome://extensions"})}),e("#searchPocket-btn").click(function(){e("#menu li").removeClass("active"),e(this).parent().addClass("active");var t=e(this).parent().attr("data-target");e("#loader img").attr("src","images/"+t+"-btn.png"),e(".content").removeClass("show"),e("#loader").show(),chrome.storage.sync.get("settings",function(e){l(e.settings.pocket.token,!0,!0)})}),e("#pocketSearch .closeDialog").click(function(){e("#pocketSearch").removeClass("show"),e("#pocketSearch input#search").val("")}),e("#addDial").find("#topSitesBtn").click(function(){chrome.topSites.get(function(t){var a=[];e.each(t,function(e,t){a.push('<li title="'+t.url+'" data-url="'+t.url+'">'+t.title+"</li>")}),e("#topSitesList ul").html(a.join("")),e("#addInputs").removeClass("show"),e("#topSitesList").addClass("show"),e("#addDial #innerDialogContent").css({height:e("#topSitesList").height()}),e("#topSitesList ul li").click(function(){var t=e(this).text(),a=e(this).attr("data-url");e("#addDial input#url").val(a),e("#addDial input#name").val(t),e("#topSitesList").removeClass("show"),e("#addInputs").addClass("show"),e("#addDial #innerDialogContent").css({height:e("#addInputs").height()+20}),e("#addInputs").find(".submit").removeClass("disabled")})})}),e("#addInputs").find(".submit").click(function(){function t(t){var o={};o[t]={id:t,name:i,url:n,thumb:"",setThumb:1,order:{home:1,work:1},smartGroups:{home:{morning:0,day:0,afternoon:0,evening:0,night:0},work:{morning:0,day:0,afternoon:0,evening:0,night:0}}},chrome.storage.sync.set(o,function(){a.hasClass("continue")?(e("#addDial input#url").val(""),e("#addDial input#name").val(""),e("#addDial input#url").focus()):(e("#addDial input#url").val(""),e("#addDial input#name").val(""),e("#addDial").removeClass("show")),s()})}var a=e(this),n=e("#addDial input#url").val(),i=e("#addDial input#name").val();a.hasClass("disabled")||chrome.storage.sync.get(null,function(a){var n=Object.keys(a).length;if(n>1){var i=0,o=n-1;e.each(a,function(e,a){if(i++,i===o){var n=a.id;n++,t(n)}})}else t(1)})}),e("#bookmarkImport").click(function(){u()})});